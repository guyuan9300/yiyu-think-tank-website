# AI_SPEC — 益语智库网站：一致性修复 & 客户专区定制化（执行规范）

> 目的：系统性解决“前台展示/按钮/数据”与“后台可维护能力”不一致的问题，并确保移动端体验（以 iPhone16 393×852 为基准）稳定。

## 0. 核心原则（不可违背）

1) **前后台联动一致**：任何前台展示字段/模块都必须在后台有对应可编辑入口；任何后台字段必须在前台有明确使用位置。
2) **客户隔离**：凡是“客户专属”的数据，都必须绑定 `projectId`（客户项目ID），前台只展示当前客户的数据。
3) **按钮必须有结果**：任何按钮只能处于三种状态之一：
   - 已实现：完成真实动作
   - 未开放：点击有明确提示 + 记录 TODO
   - 权限不足：提示原因 + 给出解决路径
   禁止“点了没反应”。
4) **移动端优先**：所有关键页面必须在 iPhone16（393×852）+ 飞书 WebView 下可用，不出现“卡片细竖条/无法点击/布局错乱”。

## 1. 当前阶段约束（本项目默认）

- 路由：SPA，通过 `?page=...` 驱动。
- 权限：**暂时仅超级管理员可切换查看全部客户**；客户账号绑定权限后续开启。
- 课程推荐来源：**站内（洞察/报告/书库）+ 外部链接**混合。

## 2. 必须产出物（每次迭代都要更新）

- `AUDIT.md`：一致性审计清单（每个模块的现状/缺口/方案/验收标准）。
- `SOURCES.md`：客户资料来源（真实互联网来源链接），以及“提炼/改写说明”。
- `_screenshots/`：关键页面修复前后截图（至少战略陪伴页 & 客户专区页各 1 组）。

## 3. 数据模型规范（必须统一）

所有客户专属实体必须包含 `projectId`：

- client_projects（客户项目本身）
  - 必须：`clientName`, `mission`, `vision`, `values[]`
  - 可选：logo、summary、客户痛点、季度主题
- milestones：必须 `projectId`
- goals：必须 `projectId`
- documents：必须 `projectId`
- meetings：必须 `projectId`
- events：必须 `projectId`
- course_recommendations：必须 `projectId`，并支持：
  - 站内引用：`type=internal`, `internalType=article|report|book`, `internalId`
  - 外部引用：`type=external`, `url`, `sourceName`

前台渲染必须按 `selectedClientId` 过滤：**没有 projectId 的数据一律不展示**（避免串数据）。

## 4. 后台必须补齐的编辑入口（P0）

在“战略客户管理后台”里，选中某个客户后必须能维护：

1) 基础信息：客户名、Mission、Vision、Values
2) 客户里程碑：新增/编辑/排序/状态
3) 本季度目标：新增/编辑/进度/指标
4) 会议：新增/编辑/会议链接/密码保护
5) 文档：新增/编辑/下载链接/密码保护
6) 动态事件：新增/编辑
7) 课程推荐：站内绑定 + 外链

保存后要求：前台切换客户可立即看到变更（刷新/重新进入亦可）。

## 5. 前台必须实现的联动行为（P0）

### 客户专区页 `?page=strategy-companion`

- 顶部客户名随客户切换
- Mission/Vision/Values 随客户切换（为空显示“请在后台填写…”）
- 里程碑/目标/会议/文档/动态/课程推荐全部按客户过滤
- 切换客户必须写入 URL：`?page=strategy-companion&clientId=xxx`

### 战略陪伴页 `?page=strategy`

- 管理员登录时，用“客户下拉”替换“了解合作方式”按钮
- 选择客户后跳转客户专区（带 clientId）

## 6. 移动端适配（iPhone16 + 飞书 WebView）（P0）

- 禁止固定 `grid-cols-4` 在手机端挤成细竖条；必须响应式。
- 横向滚动区必须具备可读卡片宽度（或改竖向列表）。
- 点击热区最小高度 44px。
- 对飞书 WebView 缓存问题提供 `?v=timestamp` 强刷方案。

## 7. 真实互联网信息补全（内容工作流）

- 必须在独立浏览器检索公开来源（官网/公众号/权威媒体）。
- 每条关键表述必须在 `SOURCES.md` 记录来源 URL。
- 找不到官方使命/愿景时：基于公开介绍提炼并注明“提炼”。
- 不得伪造“官方原话”。

## 8. 执行节奏（迭代交付）

### 迭代1（P0，闭环）
- 客户基础信息后台可编辑
- 前台切换客户联动显示
- `AUDIT.md` 初版 + 截图

### 迭代2（P0，闭环）
- 里程碑/目标/会议/文档/动态/课程推荐全部按 projectId 隔离
- 后台可维护、前台正确展示
- 5 客户初版内容 + `SOURCES.md`

### 迭代3（P1）
- 客户账号绑定权限上线
- 移动端全页精修

---

**验收口径**：每次提交必须附“如何验证”的链接与步骤。